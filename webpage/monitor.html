<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">

        <title>PiHWMonitor</title>

        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet"> 
        <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="monitor.css">
    </head>

    <body>

        <div id="error">
            <h3>Connection lost.</h3>
            <p>Is the computer powered on ?<br/>Check IP address & software status.</p>
        </div>

        <!-- <canvas id="test_canvas" width="100" height="100"> -->
        <!-- Désolé, votre navigateur ne prend pas en charge &#38;lt;canvas&#38;gt;. -->
        <!-- </canvas> -->


        <header>
            <h1 id="hostname"></h1>
            <p id="system"></p>
        </header>

        <section>
            <!-- Strange HTML markup below ? 
            Check that : https://developer.mozilla.org/fr/docs/Web/API/Document_Object_Model/Whitespace -->
            <article id="cpu_article">
                <h2></h2>
                <div class="meterheadersection"
                    ><span class="meterheader" id="cpu_header_1"></span
                    ><span class="meterheader" id="cpu_header_2"></span
                    ><span class="meterheader" id="cpu_header_3"></span>
                </div>
                <div class="metersection"
                    ><canvas id="cpu_canvas_1"></canvas
                    ><canvas id="cpu_canvas_2"></canvas
                    ><canvas id="cpu_canvas_3"></canvas>
                </div>
                <div class="meternamesection"
                    ><span class="metername" id="cpu_value_1"></span
                    ><span class="metername" id="cpu_value_2"></span
                    ><span class="metername" id="cpu_value_3"></span>
                </div>
                <div class="rawsection" id="cpu_raw"></div>
            </article>
            <article id="gpu_article">
                <h2></h2>
                <div class="meterheadersection"
                    ><span class="meterheader" id="gpu_header_1"></span
                    ><span class="meterheader" id="gpu_header_2"></span
                    ><span class="meterheader" id="gpu_header_3"></span>
                </div>
                <div class="metersection"
                    ><canvas id="gpu_canvas_1"></canvas
                    ><canvas id="gpu_canvas_2"></canvas
                    ><canvas id="gpu_canvas_3"></canvas>
                </div>
                <div class="meternamesection"
                    ><span class="metername" id="gpu_value_1"></span
                    ><span class="metername" id="gpu_value_2"></span
                    ><span class="metername" id="gpu_value_3"></span>
                </div>
                <div class="rawsection" id="gpu_raw"></div>
            </article>            
            <article id="watercooling_article">
                <h2></h2>
                <div class="meterheadersection"
                    ><span class="meterheader" id="watercooling_header_1"></span
                    ><span class="meterheader" id="watercooling_header_2"></span
                    ><span class="meterheader" id="watercooling_header_3"></span>
                </div>
                <div class="metersection"
                    ><canvas id="watercooling_canvas_1"></canvas
                    ><canvas id="watercooling_canvas_2"></canvas
                    ><canvas id="watercooling_canvas_3"></canvas>
                </div>
                <div class="meternamesection"
                    ><span class="metername" id="watercooling_value_1"></span
                    ><span class="metername" id="watercooling_value_2"></span
                    ><span class="metername" id="watercooling_value_3"></span>
                </div>
                <div class="rawsection" id="watercooling_raw"></div>
            </article>            
            <article id="other_article">
                <h2></h2>
                <div class="meterheadersection"
                    ><span class="meterheader" id="other_header_1"></span
                    ><span class="meterheader" id="other_header_2"></span
                    ><span class="meterheader" id="other_header_3"></span>
                </div>
                <div class="metersection"
                    ><canvas id="other_canvas_1"></canvas
                    ><canvas id="other_canvas_2"></canvas
                    ><canvas id="other_canvas_3"></canvas>
                </div>
                <div class="meternamesection"
                    ><span class="metername" id="other_value_1"></span
                    ><span class="metername" id="other_value_2"></span
                    ><span class="metername" id="other_value_3"></span>
                </div>
                <div class="rawsection" id="other_raw"></div>
            </article>
        </section>

        <script src="https://bernii.github.io/gauge.js/dist/gauge.min.js"></script>
        <script>
            const header = document.querySelector('header');
            const section = document.querySelector('section');
            const error = document.getElementById('error');

            var cpu_article = document.getElementById("cpu_article");
            var gpu_article = document.getElementById("gpu_article");
            var watercooling_article = document.getElementById("watercooling_article");
            var other_article = document.getElementById("other_article");

            var cpu_raw = document.getElementById("cpu_raw");
            var gpu_raw = document.getElementById("gpu_raw");
            var watercooling_raw = document.getElementById("watercooling_raw");
            var other_raw = document.getElementById("other_raw");

            var cpu_header_1 = document.getElementById('cpu_header_1');
            var cpu_header_2 = document.getElementById('cpu_header_2');            
            var cpu_header_3 = document.getElementById('cpu_header_3');
            var gpu_header_1 = document.getElementById('gpu_header_1');            
            var gpu_header_2 = document.getElementById('gpu_header_2');
            var gpu_header_3 = document.getElementById('gpu_header_3');            
            var watercooling_header_1 = document.getElementById('watercooling_header_1');
            var watercooling_header_2 = document.getElementById('watercooling_header_2');            
            var watercooling_header_3 = document.getElementById('watercooling_header_3');
            var other_header_1 = document.getElementById('other_header_1');            
            var other_header_2 = document.getElementById('other_header_2');
            var other_header_3 = document.getElementById('other_header_3');            

            var cpu_canvas_1 = document.getElementById('cpu_canvas_1');
            var cpu_canvas_2 = document.getElementById('cpu_canvas_2');            
            var cpu_canvas_3 = document.getElementById('cpu_canvas_3');
            var gpu_canvas_1 = document.getElementById('gpu_canvas_1');            
            var gpu_canvas_2 = document.getElementById('gpu_canvas_2');
            var gpu_canvas_3 = document.getElementById('gpu_canvas_3');            
            var watercooling_canvas_1 = document.getElementById('watercooling_canvas_1');
            var watercooling_canvas_2 = document.getElementById('watercooling_canvas_2');            
            var watercooling_canvas_3 = document.getElementById('watercooling_canvas_3');
            var other_canvas_1 = document.getElementById('other_canvas_1');            
            var other_canvas_2 = document.getElementById('other_canvas_2');
            var other_canvas_3 = document.getElementById('other_canvas_3');            

            var cpu_value_1 = document.getElementById('cpu_value_1');
            var cpu_value_2 = document.getElementById('cpu_value_2');            
            var cpu_value_3 = document.getElementById('cpu_value_3');
            var gpu_value_1 = document.getElementById('gpu_value_1');            
            var gpu_value_2 = document.getElementById('gpu_value_2');
            var gpu_value_3 = document.getElementById('gpu_value_3');            
            var watercooling_value_1 = document.getElementById('watercooling_value_1');
            var watercooling_value_2 = document.getElementById('watercooling_value_2');            
            var watercooling_value_3 = document.getElementById('watercooling_value_3');
            var other_value_1 = document.getElementById('other_value_1');            
            var other_value_2 = document.getElementById('other_value_2');
            var other_value_3 = document.getElementById('other_value_3');



            var opts_rpm = 
            {
              angle: -0.15, // The span of the gauge arc
              lineWidth: 0.25, // The line thickness
              radiusScale: 1, // Relative radius
              pointer: {
                length: 0.57, // Relative to gauge radius
                strokeWidth: 0.042, // The thickness
                color: '#000000' // Fill color
              },
              limitMax: false,     // If false, max value increases automatically if value > maxValue
              limitMin: false,     // If true, the min value of the gauge will be fixed
              colorStart: '#6FADCF',   // Colors
              colorStop: '#8FC0DA',    // just experiment with them
              percentColors: [[0.0, "#a9ff0b" ], [0.75, "#f9c802"], [1.0, "#ff0000"]],
              strokeColor: '#E0E0E0',  // to see which ones work best for you
              generateGradient: true,
              highDpiSupport: true,     // High resolution support
              
            }; 
            var opts_temp = 
            {
              angle: -0.15, // The span of the gauge arc
              lineWidth: 0.25, // The line thickness
              radiusScale: 1, // Relative radius
              pointer: {
                length: 0.57, // Relative to gauge radius
                strokeWidth: 0.042, // The thickness
                color: '#000000' // Fill color
              },
              limitMax: false,     // If false, max value increases automatically if value > maxValue
              limitMin: false,     // If true, the min value of the gauge will be fixed
              colorStart: '#6FADCF',   // Colors
              colorStop: '#8FC0DA',    // just experiment with them
              percentColors: [[0.0, "#a9ff0b" ], [0.75, "#f9c802"], [1.0, "#ff0000"]],
              strokeColor: '#E0E0E0',  // to see which ones work best for you
              generateGradient: true,
              highDpiSupport: true,     // High resolution support
              
            }; 
            var opts_percent = 
            {
              angle: -0.15, // The span of the gauge arc
              lineWidth: 0.25, // The line thickness
              radiusScale: 1, // Relative radius
              pointer: {
                length: 0.57, // Relative to gauge radius
                strokeWidth: 0.042, // The thickness
                color: '#000000' // Fill color
              },
              limitMax: false,     // If false, max value increases automatically if value > maxValue
              limitMin: false,     // If true, the min value of the gauge will be fixed
              colorStart: '#6FADCF',   // Colors
              colorStop: '#8FC0DA',    // just experiment with them
              percentColors: [[0.0, "#a9ff0b" ], [0.75, "#f9c802"], [1.0, "#ff0000"]],
              strokeColor: '#E0E0E0',  // to see which ones work best for you
              generateGradient: true,
              highDpiSupport: true,     // High resolution support
              
            };
            var opts_ghz = 
            {
              angle: -0.15, // The span of the gauge arc
              lineWidth: 0.25, // The line thickness
              radiusScale: 1, // Relative radius
              pointer: {
                length: 0.57, // Relative to gauge radius
                strokeWidth: 0.042, // The thickness
                color: '#000000' // Fill color
              },
              limitMax: false,     // If false, max value increases automatically if value > maxValue
              limitMin: false,     // If true, the min value of the gauge will be fixed
              //colorStart: '#6FADCF',   // Colors
              //colorStart: '#ff0000',   // Colors              
              //colorStop: '#8FC0DA',    // just experiment with them
              percentColors: [[0.0, "#a9ff0b" ], [0.75, "#f9c802"], [1.0, "#ff0000"]],
              strokeColor: '#E0E0E0',  // to see which ones work best for you
              generateGradient: true,
              highDpiSupport: true,     // High resolution support
              
            };

            var cpu_gauge_1 = new Gauge(cpu_canvas_1).setOptions(opts_percent); // create sexy gauge!
            cpu_gauge_1.maxValue = 100; // set max gauge value
            // cpu_gauge_1.setTextField(document.getElementById('cpu_header_1'));
            cpu_gauge_1.setMinValue(0);  // Prefer setter over gauge.minValue = 0
            cpu_gauge_1.animationSpeed = 32; // set animation speed (32 is default value)
            cpu_gauge_1.set(50); // set actual value
            var cpu_gauge_2 = new Gauge(cpu_canvas_2).setOptions(opts_temp); // create sexy gauge!
            cpu_gauge_2.maxValue = 100; // set max gauge value
            // cpu_gauge_2.setTextField(document.getElementById('cpu_header_2'));
            cpu_gauge_2.setMinValue(20);  // Prefer setter over gauge.minValue = 0
            cpu_gauge_2.animationSpeed = 32; // set animation speed (32 is default value)
            cpu_gauge_2.set(40); // set actual value
            var cpu_gauge_3 = new Gauge(cpu_canvas_3).setOptions(opts_ghz); // create sexy gauge!
            cpu_gauge_3.maxValue = 4.5; // set max gauge value
            // cpu_gauge_3.setTextField(document.getElementById('cpu_header_3'));
            cpu_gauge_3.setMinValue(2.2);  // Prefer setter over gauge.minValue = 0
            cpu_gauge_3.animationSpeed = 32; // set animation speed (32 is default value)
            cpu_gauge_3.set(2.44); // set actual value                
            
            var gpu_gauge_1 = new Gauge(gpu_canvas_1).setOptions(opts_temp); // create sexy gauge!
            gpu_gauge_1.maxValue = 110; // set max gauge value
            // gpu_gauge_1.setTextField(document.getElementById('gpu_header_1'));
            gpu_gauge_1.setMinValue(20);  // Prefer setter over gauge.minValue = 0
            gpu_gauge_1.animationSpeed = 32; // set animation speed (32 is default value)
            gpu_gauge_1.set(40); // set actual value
            var gpu_gauge_2 = new Gauge(gpu_canvas_2).setOptions(opts_percent); // create sexy gauge!
            gpu_gauge_2.maxValue = 100; // set max gauge value
            // gpu_gauge_2.setTextField(document.getElementById('gpu_header_2'));
            gpu_gauge_2.setMinValue(0);  // Prefer setter over gauge.minValue = 0
            gpu_gauge_2.animationSpeed = 32; // set animation speed (32 is default value)
            gpu_gauge_2.set(50); // set actual value
            var gpu_gauge_3 = new Gauge(gpu_canvas_3).setOptions(opts_rpm); // create sexy gauge!
            gpu_gauge_3.maxValue = 3000; // set max gauge value
            // gpu_gauge_3.setTextField(document.getElementById('gpu_header_3'));
            gpu_gauge_3.setMinValue(0);  // Prefer setter over gauge.minValue = 0
            gpu_gauge_3.animationSpeed = 32; // set animation speed (32 is default value)
            gpu_gauge_3.set(0); // set actual value 
            
            var watercooling_gauge_1 = new Gauge(watercooling_canvas_1).setOptions(opts_temp); // create sexy gauge!
            watercooling_gauge_1.maxValue = 60; // set max gauge value
            // watercooling_gauge_1.setTextField(document.getElementById('watercooling_header_1'));
            watercooling_gauge_1.setMinValue(20);  // Prefer setter over gauge.minValue = 0
            watercooling_gauge_1.animationSpeed = 32; // set animation speed (32 is default value)
            watercooling_gauge_1.set(25); // set actual value
            var watercooling_gauge_2 = new Gauge(watercooling_canvas_2).setOptions(opts_rpm); // create sexy gauge!
            watercooling_gauge_2.maxValue = 3000; // set max gauge value
            // watercooling_gauge_2.setTextField(document.getElementById('watercooling_header_2'));
            watercooling_gauge_2.setMinValue(0);  // Prefer setter over gauge.minValue = 0
            watercooling_gauge_2.animationSpeed = 32; // set animation speed (32 is default value)
            watercooling_gauge_2.set(1000); // set actual value
            var watercooling_gauge_3 = new Gauge(watercooling_canvas_3).setOptions(opts_rpm); // create sexy gauge!
            watercooling_gauge_3.maxValue = 3000; // set max gauge value
            // watercooling_gauge_3.setTextField(document.getElementById('watercooling_header_3'));
            watercooling_gauge_3.setMinValue(0);  // Prefer setter over gauge.minValue = 0
            watercooling_gauge_3.animationSpeed = 32; // set animation speed (32 is default value)
            watercooling_gauge_3.set(2000); // set actual value 

            var other_gauge_1 = new Gauge(other_canvas_1).setOptions(opts_percent); // create sexy gauge!
            other_gauge_1.maxValue = 100; // set max gauge value
            // other_gauge_1.setTextField(document.getElementById('other_header_1'));
            other_gauge_1.setMinValue(0);  // Prefer setter over gauge.minValue = 0
            other_gauge_1.animationSpeed = 32; // set animation speed (32 is default value)
            other_gauge_1.set(50); // set actual value
            var other_gauge_2 = new Gauge(other_canvas_2).setOptions(opts_percent); // create sexy gauge!
            other_gauge_2.maxValue = 100; // set max gauge value
            // other_gauge_2.setTextField(document.getElementById('other_header_2'));
            other_gauge_2.setMinValue(0);  // Prefer setter over gauge.minValue = 0
            other_gauge_2.animationSpeed = 32; // set animation speed (32 is default value)
            other_gauge_2.set(50); // set actual value
            var other_gauge_3 = new Gauge(other_canvas_3).setOptions(opts_rpm); // create sexy gauge!
            other_gauge_3.maxValue = 4.5; // set max gauge value
            // other_gauge_3.setTextField(document.getElementById('other_header_3'));
            other_gauge_3.setMinValue(2.2);  // Prefer setter over gauge.minValue = 0
            other_gauge_3.animationSpeed = 32; // set animation speed (32 is default value)
            other_gauge_3.set(2.44); // set actual value 

            //getData();
            setInterval(function(){ getData(); }, 1000);        
            
            function getData()
            {
                var requestURL = 'http://192.168.42.1:5000';
                var request = new XMLHttpRequest();
                request.open('GET', requestURL);
                request.onerror = function() { error.style.display = "block"; };
                request.responseType = 'json';
                request.send();
                request.onload = function() 
                {
                    var json = request.response;
                    //header.textContent = '';
                    //section.textContent = '';
                    cpu_raw.textContent = '';
                    gpu_raw.textContent = '';
                    watercooling_raw.textContent = '';
                    other_raw.textContent = '';
                    
                    error.style.display = "none";
                    populateHeader(json);
                    showData(json);
                }
            }

            function populateHeader(jsonObj) 
            {
                var myH1 = document.getElementById("hostname");
                var myP = document.getElementById("system");
                myH1.textContent = jsonObj['hostname'];
                myP.textContent = jsonObj['system'];
            }

            function showData(jsonObj)
            {
                var components = jsonObj['components'];
                components.forEach(component => 
                {
                    if(component.label.includes('CPU'))
                    {
                        var currentArticle = cpu_article;
                    }
                    else if(component.label.includes('GPU'))
                    {
                        var currentArticle = gpu_article;
                    }
                    else if(component.label.includes('Watercooling'))
                    {
                        var currentArticle = watercooling_article;
                    }
                    else if(component.label.includes('Others'))
                    {
                        var currentArticle = other_article;
                    }
                    else
                    {
                        // no component should be here for now
                    }

                    // first child (h2) selection
                    var label = currentArticle.firstElementChild;
                    label.textContent = component.label;

                    for (var i = 0; i < component['probe'].length; i++)
                    {

                        if(component['probe'][i].name.includes('Load'))
                        {
                            cpu_gauge_1.set(component['probe'][i].current);
                            cpu_header_1.textContent = component['probe'][i].name;
                            cpu_value_1.textContent = component['probe'][i].current + ' %';
                            continue;
                        }
                        else if(component['probe'][i].name.includes('Tctl'))
                        {
                            cpu_gauge_2.set(component['probe'][i].current);
                            cpu_header_2.textContent = component['probe'][i].name;
                            cpu_value_2.textContent = component['probe'][i].current + ' °C';
                            continue;
                        }
                        else if(component['probe'][i].name.includes('Freq'))
                        {
                            cpu_gauge_3.set(component['probe'][i].current);
                            cpu_header_3.textContent = component['probe'][i].name;
                            cpu_value_3.textContent = component['probe'][i].current + ' Ghz';
                            continue;
                        }                                    
                        else if(component['probe'][i].name.includes('edge'))
                        {
                            gpu_gauge_1.set(component['probe'][i].current);
                            gpu_header_1.textContent = component['probe'][i].name;
                            gpu_value_1.textContent = component['probe'][i].current + ' °C';
                            continue;
                        }                           
                        else if(component['probe'][i].name.includes('gpu load'))
                        {
                            gpu_gauge_2.set(component['probe'][i].current);
                            gpu_header_2.textContent = component['probe'][i].name;
                            gpu_value_2.textContent = component['probe'][i].current + ' %';
                            continue;
                        }                           
                        else if(component['probe'][i].name.includes('fan'))
                        {
                            gpu_gauge_3.set(component['probe'][i].current);
                            gpu_header_3.textContent = component['probe'][i].name;
                            gpu_value_3.textContent = component['probe'][i].current + ' RPM';
                            continue;
                        }                           
                        else if(component['probe'][i].name.includes('Liquid'))
                        {
                            watercooling_gauge_1.set(component['probe'][i].current);
                            watercooling_header_1.textContent = component['probe'][i].name;
                            watercooling_value_1.textContent = component['probe'][i].current + ' °C';
                            continue;
                        }                           
                        else if(component['probe'][i].name.includes('Fan 1'))
                        {
                            watercooling_gauge_2.set(component['probe'][i].current);
                            watercooling_header_2.textContent = component['probe'][i].name;
                            watercooling_value_2.textContent = component['probe'][i].current + ' RPM';
                            continue;
                        }
                        else if(component['probe'][i].name.includes('Pump'))
                        {
                            watercooling_gauge_3.set(component['probe'][i].current);
                            watercooling_header_3.textContent = component['probe'][i].name;
                            watercooling_value_3.textContent = component['probe'][i].current + ' RPM';
                            continue;
                        }
                        else if(component['probe'][i].name.includes('RAM Usage'))
                        {
                            other_gauge_1.set(component['probe'][i].current);
                            other_header_1.textContent = component['probe'][i].name;
                            other_value_1.textContent = component['probe'][i].current + ' %';
                            continue;
                        }                           
                        else if(component['probe'][i].name.includes('Disk'))
                        {
                            other_gauge_2.set(component['probe'][i].current);
                            other_header_2.textContent = component['probe'][i].name;
                            other_value_2.textContent = component['probe'][i].current + ' %';
                            continue;
                        }









                        var p = document.createElement('span');
                        if(component['probe'][i].type === 'temp')
                            p.textContent = component['probe'][i].name + ': ' + component['probe'][i].current + ' °C';
                        else if(component['probe'][i].type === 'fan')
                            p.textContent = component['probe'][i].name + ': ' + component['probe'][i].current + ' RPM';
                        else if(component['probe'][i].type === 'percent')
                            p.textContent = component['probe'][i].name + ': ' + component['probe'][i].current + ' %';
                        else if(component['probe'][i].type === 'freq')
                            p.textContent = component['probe'][i].name + ': ' + component['probe'][i].current + ' Ghz';
                        else if(component['probe'][i].type === 'ram_usage')
                            p.textContent = component['probe'][i].name + ': ' + component['probe'][i].current + ' Gb / ' + component['probe'][i].max + ' Gb'; 
                        
                        // select current article last element child (div raw)
                        currentArticle.lastElementChild.appendChild(p);
                    }

                    // var myH2 = document.createElement('h2');
                    // var myArticle = document.createElement('article');
                    // myH2.textContent = component.label;
                    // myArticle.appendChild(myH2);
    
                    // var meterheader = document.createElement('div');
                    // meterheader.setAttribute("id", "meterheadersection");
                    //
                    // var metersection = document.createElement('div');
                    // metersection.setAttribute("id", "metersection");
                    //
                    // if(component.label.includes('CPU'))
                    // {
                    //     var meterheader1 = document.createElement('span');
                    //     meterheader1.setAttribute("class", "meterheader");
                    //     meterheader1.setAttribute("id", "cpu_header_1");
                    //     meterheader.appendChild(meterheader1);
                    //     var meterheader2 = document.createElement('span');
                    //     meterheader2.setAttribute("class", "meterheader");
                    //     meterheader2.setAttribute("id", "cpu_header_2");
                    //     meterheader.appendChild(meterheader2);
                    //     var meterheader3 = document.createElement('span');
                    //     meterheader3.setAttribute("class", "meterheader");
                    //     meterheader3.setAttribute("id", "cpu_header_3");
                    //     meterheader.appendChild(meterheader3); 
                    //
                    //     var meter1 = document.createElement('canvas');
                    //     meter1.setAttribute("id", "cpu_canvas_1");
                    //     metersection.appendChild(meter1);
                    //     var meter2 = document.createElement('canvas');
                    //     meter2.setAttribute("id", "cpu_canvas_2");
                    //     metersection.appendChild(meter2);
                    //     var meter3 = document.createElement('canvas');
                    //     meter3.setAttribute("id", "cpu_canvas_3");
                    //     metersection.appendChild(meter3);
                    //
                    //
                    // }
                    // else
                    // {
                    //     var meter1 = document.createElement('canvas');
                    //     metersection.appendChild(meter1);
                    //     var meter2 = document.createElement('canvas');
                    //     metersection.appendChild(meter2);
                    //
                    // }
                    // myArticle.appendChild(meterheader);                    
                    // myArticle.appendChild(metersection);


                    //section.appendChild(myArticle);
                });
            }

        </script>
    </body>
</html>
